<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Settings</title>
	<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
	<script>
		function validateEmail(email) {
			const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
			return re.test(email);
		}

		function validatePhoneNumber(phone) {
			const re = /^\+?[1-9]\d{1,14}$/;
			return re.test(phone);
		}

		function validateForm() {
			const email = document.getElementById('email').value;
			const phone = document.getElementById('phone').value;
			let valid = true;

			if (!validateEmail(email)) {
				alert('Please enter a valid email address.');
				valid = false;
			}

			if (!validatePhoneNumber(phone)) {
				alert('Please enter a valid phone number in E.164 format (e.g., +1234567890).');
				valid = false;
			}

			return valid;
		}
	</script>
</head>
<body class="bg-gray-100">
	{{ template "header.html" . }}

	<div class="container mx-auto mt-8 space-y-8">
		{{ if .IsAdmin }}
		<div class="p-8 bg-white rounded-md shadow-md">
			<h3 class="text-2xl font-semibold mb-4">Select User to Edit</h3>
			<table class="min-w-full bg-white">
				<thead>
					<tr>
						<th class="py-2">User ID</th>
						<th class="py-2">Name</th>
						<th class="py-2">Email</th>
					</tr>
				</thead>
				<tbody id="userGrid" class="divide-y divide-gray-200">
					{{ range $index, $agent := .Agents }}
					<tr class="cursor-pointer hover:bg-gray-100" onclick="selectUser(this, '{{ $agent.ID }}', '{{ $agent.Email }}', '{{ $agent.Number }}')">
						<td class="text-center py-2">{{ $agent.ID }}</td>
						<td class="text-center py-2">{{ $agent.Username }}</td>
						<td class="text-center py-2">{{ $agent.Email }}</td>
					</tr>
					{{ end }}
				</tbody>
			</table>
			<div class="mt-4 flex space-x-2">
				<button onclick="addUser()" class="px-2 py-1 bg-green-500 text-white rounded-md hover:bg-green-600">
					<i class="fas fa-user-plus"></i> Add
				</button>
				<button id="deleteUserButton" onclick="deleteUser()" class="px-2 py-1 bg-red-500 text-white rounded-md hover:bg-red-600" disabled>
					<i class="fas fa-user-minus"></i> Delete
				</button>
			</div>
		</div>
		{{ end }}

		<div class="p-8 bg-white rounded-md shadow-md">
			<h3 class="text-2xl font-semibold mb-4">My Settings</h3>
			<form onsubmit="return validateForm()">
				<div class="mb-4">
					<label for="email" class="block text-sm font-medium text-gray-600">Email Address</label>
					<input type="email" id="email" name="email" class="mt-1 p-2 w-full border rounded-md" required>
				</div>

				<div class="mb-4">
					<label for="phone" class="block text-sm font-medium text-gray-600">Phone Number</label>
					<p class="text-xs text-gray-500 mb-1">Format: +1234567890</p>
					<input type="tel" id="phone" name="phone" class="mt-1 p-2 w-full border rounded-md" required>
				</div>

				<div class="mb-4">
					<label for="password" class="block text-sm font-medium text-gray-600">New Password</label>
					<input type="password" id="password" name="password" class="mt-1 p-2 w-full border rounded-md">
				</div>

				<div class="mb-4">
					<label for="confirmPassword" class="block text-sm font-medium text-gray-600">Confirm New Password</label>
					<input type="password" id="confirmPassword" name="confirmPassword" class="mt-1 p-2 w-full border rounded-md">
				</div>

				<button type="submit" class="w-full py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 focus:outline-none focus:ring focus:border-blue-300">
					Save Changes
				</button>
			</form>
		</div>
	</div>

	<script>
		let selectedUserId = null;
		let selectedRow = null;

		function selectUser(row, id, email, phone) {
			if (selectedRow) {
				selectedRow.classList.remove('bg-blue-100');
			}
			selectedRow = row;
			selectedRow.classList.add('bg-blue-100');

			selectedUserId = id;
			document.getElementById('email').value = email;
			document.getElementById('phone').value = phone;
			document.getElementById('deleteUserButton').disabled = false;
		}

		function addUser() {
			alert('Add User functionality to be implemented.');
		}

		function deleteUser() {
			if (selectedUserId) {
				alert(`Delete User functionality for user ID ${selectedUserId} to be implemented.`);
				// Implement the logic to delete the user
			}
		}

		// Apply alternating row colors using JavaScript
		document.addEventListener('DOMContentLoaded', function() {
			const rows = document.querySelectorAll('#userGrid tr');
			rows.forEach((row, index) => {
				if (index % 2 === 0) {
					row.classList.add('bg-gray-50');
				} else {
					row.classList.add('bg-white');
				}
			});
		});
	</script>
</body>
</html>