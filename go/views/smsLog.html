<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Sea Cow Phone - Messaging App</title>
	<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
	<style>
		.conversation-list {
			width: 25%;
			border-right: 1px solid #ddd;
			overflow-y: auto;
		}
		.conversation-detail {
			width: 75%;
			padding: 20px;
		}
		.message {
			margin-bottom: 10px;
			padding: 10px;
			border-radius: 15px;
			max-width: 60%;
			position: relative;
			display: inline-block;
		}
		.message.sent {
			background-color: #e1ffc7;
			align-self: flex-end;
			margin-left: auto;
		}
		.message.received {
			background-color: #f1f1f1;
			align-self: flex-start;
			margin-right: auto;
		}
		.message-time {
			font-size: 0.75rem;
			color: #555;
			position: absolute;
			bottom: -15px;
			right: 10px;
		}
	</style>
</head>
<body class="flex flex-col h-screen">
	<!-- Header -->
	<div class="bg-blue-500 text-white p-4">
		<div class="container mx-auto">
			<div class="flex items-center">
				<img src="/kayaking-staugustine-logo-512.webp" alt="Sea Cow Phone Logo" style="height: 40px; margin-right: 15px;">
				<h1 class="text-xl font-semibold">Sea Cow Phone</h1>
			</div>
			<div class="flex justify-between items-center">
				<div class="flex space-x-4">
					<a href="/callLog" class="text-white font-bold border border-white px-4 py-1 rounded-md transition duration-300 ease-in-out transform hover:bg-white hover:text-blue-500 hover:scale-105 active:scale-95">Call Logs</a>
					<a href="/smsLog" class="text-white font-bold border border-white px-4 py-1 rounded-md ml-2 transition duration-300 ease-in-out transform hover:bg-white hover:text-blue-500 hover:scale-105 active:scale-95">SMS Logs</a>
					<div class="flex items-center">
						<span class="mr-2">Logged in as:</span>
						<span class="font-semibold">{{.Username}}</span>
					</div>
				</div>
			</div>
		</div>
	</div>

	<div class="flex flex-grow">
		<div class="conversation-list bg-gray-100 p-4">
			<h2 class="text-lg font-semibold mb-4">Conversations</h2>
			<ul id="conversationList">
				<!-- Populate conversation list with phone numbers -->
			</ul>
		</div>

		<div class="conversation-detail flex flex-col bg-white">
			<h2 class="text-lg font-semibold mb-4">Messages</h2>
			<div id="messageContainer" class="flex flex-col flex-grow overflow-y-auto">
				<!-- Messages will be populated here -->
			</div>
		</div>
	</div>

	<script>
		const conversations = {};

		window.onload = function() {
			fetch('/readMessagedPhoneNumbers')
				.then(response => response.json())
				.then(data => {
					data.forEach(phoneNumber => {
						conversations[phoneNumber] = [];
						const li = document.createElement('li');
						li.className = "cursor-pointer p-2 hover:bg-gray-200";
						li.textContent = phoneNumber;
						li.onclick = function() {
							loadMessages(phoneNumber);
						};
						document.getElementById('conversationList').appendChild(li);
					});
				});
		};

		function loadMessages(phoneNumber) {
			fetch('/readMessageHistory', {
				method: 'POST',
				headers: {
					'Content-Type': 'application/x-www-form-urlencoded'
				},
				body: new URLSearchParams({ phoneNumber: phoneNumber })
			})
			.then(response => response.json())
			.then(messages => {
				const messageContainer = document.getElementById('messageContainer');
				messageContainer.innerHTML = ''; // Clear previous messages

				messages.forEach(message => {
					const messageDiv = document.createElement('div');
					messageDiv.className = `message ${message.type}`;
					
					const messageText = document.createElement('div');
					messageText.textContent = message.Body;
					
					const messageTime = document.createElement('div');
					messageTime.className = 'message-time';
					const date = new Date(message.SentDate);
					messageTime.textContent = `${date.toLocaleDateString()} ${date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}`;

					messageDiv.appendChild(messageText);
					messageDiv.appendChild(messageTime);
					messageContainer.appendChild(messageDiv);
				});
			});
		}
	</script>
</body>
</html>