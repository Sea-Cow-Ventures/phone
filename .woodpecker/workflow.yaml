steps:
  - name: build
    image: golang:latest
    environment:
      GOOS: linux
      GOARCH: amd64
    commands:
      - cd go
      - go mod tidy
      - mkdir -p build
      - go build -o ./build/seacow-phone ./cmd/seacow-phone
    when:
      - branch: [main]

  - name: docker
    image: docker:24.0.5
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    commands:
      - docker build -t seacow-phone:local .
    when:
      - branch: [main]
